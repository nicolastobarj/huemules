<script>
document.addEventListener('DOMContentLoaded', function(){
  // If there's no home banner (we're on an inner page), show the sticky site nav by default
  if(!document.querySelector('.home-banner')){
    document.body.classList.add('show-site-nav');
    const siteNav = document.querySelector('.site-nav');
    if(siteNav) siteNav.setAttribute('aria-hidden','false');
  }

  function findAndHighlight(q){
    const nodes = Array.from(document.querySelectorAll('h1,h2,h3,h4,p,li'));
    const found = nodes.find(n => n.textContent && n.textContent.toLowerCase().includes(q.toLowerCase()));
    if(!found) return false;
    found.scrollIntoView({behavior:'smooth', block:'center'});
    found.style.transition = 'box-shadow .4s ease, background .4s ease';
    const originalBg = found.style.background;
    found.style.background = 'rgba(255,255,0,0.15)';
    setTimeout(function(){ found.style.background = originalBg; }, 1800);
    return true;
  }

  function bindSearch(buttonSelector, containerSelector, formSelector, inputSelector){
    const button = document.querySelector(buttonSelector);
    const container = document.querySelector(containerSelector);
    const form = document.querySelector(formSelector);
    const input = form ? form.querySelector(inputSelector) : null;
    if(!button || !container || !form || !input) return;
    if(button.dataset.searchBound === '1') return;

    button.dataset.searchBound = '1';

    button.addEventListener('click', function(e){
      e.preventDefault();
      container.classList.toggle('search-open');
      if(container.classList.contains('search-open')) input.focus();
    });

    form.addEventListener('submit', function(e){
      e.preventDefault();
      const q = (input.value || '').trim();
      if(!q) return;
      const ok = findAndHighlight(q);
      if(!ok){
        alert('No se encontraron resultados para "' + q + '"');
        return;
      }
      container.classList.remove('search-open');
    });
  }

  bindSearch('.nav-search-btn', '.site-nav', '.nav-search-form', 'input[type="search"]');
  bindSearch('.banner-search-btn', '.home-banner', '.banner-search-form', 'input[name="bq"]');
});
</script>
